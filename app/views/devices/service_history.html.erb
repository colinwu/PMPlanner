<% title @title, false %>
<br />
<%= render partial: "header_table", locals: {button: "history"} %>

<% unless @device.nil? %>
  <table width="100%">
    <caption>Counter History</caption>
    <tr>
      <th>Date Readings Taken</th>
      <th class='rightjustify'>BW</th>
      <% if @device.model.model_group.color_flag %>
        <th class='rightjustify'>Colour</th>
      <% end %>
      <% @all_codes.each do |c| %>
        <th class='rightjustify'><%=h c %></th>
      <% end %>
      <th>Action</th>
    </tr>
    <% for reading in @readings %>
      <% zero_reading = true %>
      <tr class="<%= cycle('light','dark') %>">
        <td><span title="<%=h reading.notes %>"><%=h best_in_place(reading, :taken_at, as: :date, :display_with => lambda {|d| d.to_s(:MdY)}) %></span></td>
        <% counter = reading.counter_for('bwtotal') %>
        <td class=rightjustify><%= best_in_place(counter, :value, display_with: :number_with_delimiter, html_attrs: {size: 6, class: 'rightjustify'}) %></td>
        <% if @device.model.model_group.color_flag %>
          <% counter = reading.counter_for('ctotal') %>
          <td class=rightjustify><%= counter.nil? ? '' : best_in_place(counter, :value,  display_with: :number_with_delimiter, html_attrs: {size: 6, class: 'rightjustify'}) %></td>
        <% end %>
        <% @all_codes.each do |c| %>
          <% counter = reading.counter_for(c) %>
          <td class=rightjustify><%= counter.nil? ? '' : best_in_place(counter, :value, display_with: :number_with_delimiter, html_attrs: {size: 6, class: 'rightjustify'}) %></td>
        <% end %>
        <td><%= link_to "Remove", reading, :confirm => 'Are you sure?', :method => :delete %></td>
      </tr>
    <% end %>
  </table>
<% end %>

