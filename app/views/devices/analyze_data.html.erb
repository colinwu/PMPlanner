<% title @title, true %>
<div id="bw_hidden"><%= @bw_list %></div>
<div id="c_hidden"><%= @c_list %></div>
<div id="all_hidden"><%= @all_list %></div>
<br />
<%= render partial: "header_table", locals: {button: "analysis"} %>

<% unless @device.nil? or @prev_reading.nil? %>
<table width="100%">
  <%= form_tag(record_data_device_url,  id: "counter_form") do %>
  <tr>
    <th>PM Code</th>
    <th>PM Description</th>
    <th>Previous Readings<br /><%= @prev_reading.nil? ? ' ' : @prev_reading.taken_at.strftime('%b %-d, %Y') %></th>
    <th><% if @todays_reading.nil? %>
      Current Estimate
      <% else %>
      Today's Entry
      <% end %><br /><%= text_field_tag 'reading[taken_at]', Date::today.to_s(:MdY), {class: 'center'} %></th>
    <th>Progress to next PM</th>
    <th>Next PM Date</th>
  </tr>
    <%= hidden_field_tag 'reading[technician_id]', @prev_reading.technician_id %>
    <%= hidden_field_tag 'reading[device_id]', @prev_reading.device_id %>

    <% @rows.each do |r| %>
      <tr class=<%= r[0] %>>
        <td><%= r[1].upcase %></td>
        <td><%= r[2] %></td>
        <td class=rightjustify><span id="prev_<%= r[1].upcase %>"><%= number_with_delimiter(r[3]) %></span></td>
        <td class=rightjustify><%= text_field_tag "counter[#{r[1]}]", number_with_delimiter(r[4]), {class: 'rightjustify'} %></td>
        <td class=rightjustify><%= progress_bar(r[5], :color => 'white', :tiny => true, :rounded => false) %></td>
        <td class=rightjustify><%= r[6] %> </td>
      </tr>
    <% end %>
    <tr><td colspan=6>
      <% notes = @todays_reading.nil? ? @prev_reading.notes : @todays_reading.notes %>
      <%= text_area_tag 'reading[notes]', notes, rows: 5, cols: 60 %>
    </td></tr>
    <tr><td>
      <%= submit_tag "Save Reading", id: 'save_reading' %>
    </td></tr>
  <% end %>
</table>
<% end %>
