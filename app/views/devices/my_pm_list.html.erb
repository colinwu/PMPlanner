<% title @title, false %>
<table width=100%>
  <caption>Devices with outstanding PMs</caption>
  <%= form_tag handle_checked_devices_url do %>
    <div class=context_menu>
      For selected devices (or all devices if none selected): 
      <%= submit_tag "Create Parts List", name: 'parts' %> | 
      <%= submit_tag "Create Service Order", name: 'service' %> | 
      <%= submit_tag "List All Parts", name: 'all_parts' %>
      <% if current_technician.admin? or current_technician.manager? %>
        | Transfer device(s) to <%= select_tag :to_team_id, options_from_collection_for_select(Team.all, :id, :name), include_blank: true %><%= submit_tag "Go", name: 'transfer' %>
      <% else %>
        <span class=right_end>
        <% if @showbackup %>
          <%= hidden_field_tag 'showbackup', false %>
          <%= submit_tag "Hide Backup Devices" %>
        <% else %>
          <%= hidden_field_tag 'showbackup', true %>
          <%= submit_tag "Show Backup Devices" %>
        <% end %>
        </span>
      <% end %>
    </div>
    <br />
  <tr class=pretty>
    <th></th>
    <th><%= sortable 'crm_object_id', 'CRM ID' %></th>
    <th><%= sortable 'models.name', 'Model' %></th>
    <th><%= sortable 'serial_number', 'Serial Number' %></th>
    <th><%= sortable 'clients.name', 'Client Name' %></th>
    <th><%= sortable 'locations.address1', 'Address' %></th>
    <th><%= sortable 'locations.city', 'City' %></th>
    <th><%= sortable 'outstanding_pms', 'Codes' %></th>
  </tr>
  <% @dev_list.each do |dev| %>
    <%= hidden_field_tag "alldevs[#{dev.id}]", dev.id %>
    <tr class="<%= cycle('light','dark') %><% if dev.backup_tech_id == current_technician.id %> backup_tech<% end %>">
      <td><%= check_box_tag "device[#{dev.id}]", dev.id %></td>
      <td class=rightjustify><%= link_to dev.crm_object_id, analyze_data_device_path(dev), title: "PM Analysis" %></td>
      <td><%= dev.model.name %></td>
      <td><%= dev.serial_number %></td>
      <td><%= dev.client.name %></td>
      <td><%= dev.location.address1 %></td>
      <td><%= dev.location.city %></td>
      <td class='<%= pm_status_class(dev) %>'><%= dev.outstanding_pms.length %></td>
    </tr>
  <% end %>
<% end %>
</table>
<br />
