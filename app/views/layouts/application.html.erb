<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= content_for?(:title) ? yield(:title) : "PM Planner" %></title>
    <%= stylesheet_link_tag "application", media: 'all' %>
    <%= javascript_include_tag :application %>
    <%= csrf_meta_tag %>
    <%= yield(:head) %>
  </head>
  <body>
    <div class="container-fluid">
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand"><%= @page_title.nil? ? 'PM Planner' : @page_title %></span>
          </div> <!-- navbar-headr -->
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li><%= link_to "Home", search_devices_path %></li>
              <li><%= link_to "#{replace_my} Territory", devices_path, id: "territory_menu" %></li>
              <li><%= link_to "#{replace_my} Contacts", contacts_path, id: "contacts_menu" %></li>
              <li><%= link_to "#{replace_my} PM List", my_pm_list_devices_path, id: "pm_list_menu" %></li>
              <% if (@device.nil? or @device.id.nil?) %>
                <p class="navbar-text">PM Status</p>
                <p class="navbar-text">PM History</p>
              <% else %>
                <li><%= link_to "PM Status", {controller: '/devices', action: 'analyze_data', id: @device}, id: "analyze_data_menu" %></li>
                <li><%= link_to "PM History", {controller: "/devices", action: 'service_history', id: @device}, id: "service_history_menu" %></li>
              <% end %>
              <% if not current_user.nil? and (current_user.admin? or current_user.manager?) %>
                <li><%= link_to "My Team", technicians_path, id: "team_menu" %></li>
                <li>
                  <%= form_tag select_territory_technicians_path, {:id => 'tech_select', class: "navbar-form"} do %>
                    <%= select_tag :tech_id, options_from_collection_for_select(current_user.my_techs.order(:friendly_name), :id, :friendly_name, current_technician.nil? ? nil : current_technician.id), {include_blank: true, class: "form-control"} %>
                  <% end %>
                </li>
                <% if current_user.admin? %><li><%= link_to "Admin Page", admin_path, id: "admin_menu" %></li><% end %>
              <% end %>
            </ul> <!-- class="nav navbar-nav" -->
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown">
                <% if current_user %>
                  <% session[:active_at] = Time.now %>
                  <% WillPaginate.per_page = current_user.preference.lines_per_page %>
                  <a class="dropdown-toggle" data-toggle="dropdown" href="#"><%= current_user.friendly_name %><span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><%= link_to "Sign out", logout_path %></li>
                    <li><%= link_to "My profile", edit_preference_path(current_user) %></li>
                    <li><%= link_to "Bug Report/Feature Request", "mailto://wuc@sharpsec.com?subject=PM Planner issue" %></li>
                  </ul>
                <% else %>
                  <%= link_to "Sign in", login_path %>
                <% end %>
              </li>
            </ul> <!--class="nav navbar-nav navbar-right" -->
          </div>
        </div>
      </div>
      <div id="header">
        <div id="flash_area">
          <% flash.each do |name, msg| %>
            <%= content_tag :div, msg, :id => "flash_#{name}" %>
          <% end %>
        </div>
      </div> <!-- header -->
      
      <%= yield %>
    </div>
  </body>
</html>
