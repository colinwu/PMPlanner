<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for?(:title) ? yield(:title) : "PM Planner" %></title>
    <%= stylesheet_link_tag "application", media: 'all' %>
    <%= javascript_include_tag :application %>
    <%= csrf_meta_tag %>
    <%= yield(:head) %>
  </head>
  <body>
    <div id="container">
      <div id="header">
        <div id="flash_area">
        <% flash.each do |name, msg| %>
          <%= content_tag :div, msg, :id => "flash_#{name}" %>
        <% end %>
        </div>
        <div id="tech_navbar">
          <% if current_user %>
            <% session[:active_at] = Time.now %>
            <% WillPaginate.per_page = current_user.preference.lines_per_page %>
            Signed in as <%= current_user.friendly_name -%> | 
            <%= link_to "Sign out", logout_path %> |
            <%= link_to "My profile", edit_preference_path(current_user) %>
          <% else %>
            <%= link_to "Sign in", login_path %>
          <% end %>
        </div> <!-- tech_navbar -->
      </div> <!-- header -->
      <div id="page_title">
      <%= content_tag :h1, yield(:title) %>
      </div>
      <div>
        <ul id=menu>
        <li><%= link_to "Home", search_devices_path %></li>
        <li><%= link_to "#{replace_my} Territory", devices_path, id: "territory_menu" %></li>
        <li><%= link_to "#{replace_my} Contacts", contacts_path, id: "contacts_menu" %></li>
        <li><%= link_to "#{replace_my} PM List", my_pm_list_devices_path, id: "pm_list_menu" %></li>
        <li><%= link_to_unless (@device.nil? or @device.id.nil?), "PM Status", {controller: '/devices', action: 'analyze_data', id: @device}, id: "analyze_data_menu" %></li>
        <li><%= link_to_unless (@device.nil? or @device.id.nil?), "PM History", {controller: "/devices", action: 'service_history', id: @device}, id: "service_history_menu" %></li>
        <% if not current_user.nil? and (current_user.admin? or current_user.manager?) %>
          <li><%= link_to "My Team", technicians_path, id: "team_menu" %></li>
          <li><%= link_to "Transfers", transfers_path, id: "transfer_menu" %></li>
          <li>
            <%= form_tag select_territory_technicians_path, :id => 'tech_select' do %>
              <%= select_tag :tech_id, options_from_collection_for_select(current_user.my_techs.order(:friendly_name), :id, :friendly_name, current_technician.nil? ? nil : current_technician.id), include_blank: true %>
            <% end %>
          </li>
          <% if current_user.admin? %><li><%= link_to "Admin Page", admin_path, id: "admin_menu" %></li><% end %>
        <% end %>
        </ul>
      </div>
      <%= yield %>
    </div>
  </body>
</html>
